<!DOCTYPE html>
<% if notice %>
    <div class="notice"><%= notice %></div>
<% end %>
<html>
<head>
    <% if @feed and not @feed.is_a? Fixnum%>
      <title>Reading: <%= @feed.title %></title>
  <% else %>
      <title>No active subscriptions</title>
  <% end %>
  <%= stylesheet_link_tag    "reader", :media => "all" %>
  <%= javascript_include_tag "reader" %>
  <%= javascript_include_tag :application %>
  <%= csrf_meta_tags %>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script type="text/javascript">
      $(document).ready(function() {
          $('.entry a').click(function() {
              window.open(this.href, 'onReader', 'width=600,height=800');
              return false;
          });
      });
  </script>
</head>
<body class="hero-section">
	<div class="header-wrapper">
		<header class="main-header">
			<nav class="header-nav">
				<%= link_to content_tag(:span, image_tag("oR_small.png", id: "reader-logo", alt: "onReader"), class: "home-link"), welcome_url %>
					
				<div id="subscribe" class="shadow">
				<% if session[:read_mode] == :subscription || session[:read_mode] == :random
				    #Hard link to log in/ sign up if guest tries to subscribe.
				    #super future TODO associate subscriptions to Visitor IPs so they don't need to sign up, but limit it to some low number.
				    if is_logged_in?
				        unless is_subscribed?(session[:read_mode] == :subscription ? session[:subscription_current] : session[:random_current]) %>
				          <%= link_to 'Subscribe', subscriptions_path( :id => (session[:read_mode] == :subscription ? session[:subscription_current] : session[:random_current])), :method => :post, :remote => :true%>
						<% else %>
				            <%= link_to 'Unsubscribe', subscription_path( :id => (session[:read_mode] == :subscription ? session[:subscription_current] : session[:random_current])), :method => :delete, :remote => true %>
				    	<% end 
					else %>
						<%= link_to 'Subscribe', login_path %>

				    <%  end
				    end %>
				</div>
			</nav>
		</header>
	</div>
	
	<div class="content">
		<nav>
			<% if session[:read_mode] == :random  %>
				<%= link_to '', reader_next_random_path, html_options = {:class => "flow flow-right", :alt => "next"}%>
				<%= link_to '', reader_previous_random_path, html_options = {:class => "flow flow-left", :alt => "previous"} %>
			<% else %>
				<%= link_to '', reader_next_subscription_path, html_options = {:class => "flow flow-right", :alt => "next"} %>
				<%= link_to '', reader_previous_subscription_path, html_options = {:class => "flow flow-left", :alt => "previous"} %>
			<% end %>
		</nav>
		<div class="view">
			<header class="centered-element blog-title"><h1><%= @feed.title %></h1></header>
			<div class="underlay">
				<%= yield %>
			</div>
		</div>
	</div>
</body>
</html>
